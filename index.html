<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>부동산GPT 지도검색</title>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=8c5fbd54b6d882c2387c4bc6e499c906&libraries=services"></script>
  <style>
    html, body { height:100%; margin:0; padding:0; font-family: sans-serif; }
    #topBar {
      position:absolute; top:10px; left:10px; right:10px;
      display:flex; align-items:flex-start; gap:12px; z-index:10;
    }
    /* 왼쪽 메뉴+위치 스택 */
    #leftStack {
      display:flex; flex-direction:column; gap:8px;
    }
    .btn {
      width:120px; height:56px;
      background:#fff; border:1px solid #ccc; border-radius:6px;
      font-size:18px; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      position:relative;
    }
    /* 드롭다운 */
    #dropdown {
      position:absolute; top:56px; left:0;
      width:140px;
      background:#fff; border:1px solid #ccc; border-radius:6px;
      box-shadow:0 2px 6px rgba(0,0,0,0.3);
      display:none; z-index:20;
    }
    .dropdown-item {
      padding:12px 16px; font-size:16px; cursor:pointer;
    }
    .dropdown-item:hover { background:#f0f0f0; }
    /* 검색창 */
    #searchBox {
      flex:1; display:flex; align-items:center;
      width:280px; height:56px;
      background:#fff; border:1px solid #ccc; border-radius:6px;
      padding:0 12px; box-shadow:0 1px 3px rgba(0,0,0,0.2);
      position:relative;
    }
    #keyword {
      flex:1; border:none; outline:none;
      font-size:18px; height:32px;
    }
    #searchButton {
      background:none; border:none; font-size:24px; cursor:pointer;
      margin-left:8px;
    }
    /* 결과, 지도 */
    #resultList {
      position:absolute; top:80px; left:10px; right:10px;
      max-height:240px; overflow-y:auto;
      background:#fff; border-radius:8px;
      box-shadow:0 2px 6px rgba(0,0,0,0.3);
      z-index:9; display:none;
    }
    .item {
      padding:12px; font-size:16px; cursor:pointer;
      border-bottom:1px solid #eee;
    }
    .item:hover { background:#f0f0f0; }
    #map {
      position:absolute; top:0; left:0; right:0; bottom:0;
      z-index:1;
    }
  </style>
</head>
<body>

  <div id="topBar">
    <div id="leftStack">
      <div class="btn" id="menuButton" onclick="toggleDropdown()">아파트</div>
      <div id="dropdown">
        <div class="dropdown-item" onclick="selectMenu('아파트')">아파트</div>
        <div class="dropdown-item" onclick="selectMenu('분양권')">분양권</div>
        <div class="dropdown-item" onclick="selectMenu('원룸')">원룸</div>
        <div class="dropdown-item" onclick="selectMenu('투룸')">투룸</div>
        <div class="dropdown-item" onclick="selectMenu('관심')">관심</div>
      </div>
      <div class="btn" onclick="moveToCurrentLocation()">📍 내 위치</div>
    </div>
    <div id="searchBox">
      <input type="text" id="keyword" placeholder="검색어를 입력하세요"
             onkeydown="if(event.key==='Enter') searchPlaces();" />
      <button id="searchButton" onclick="searchPlaces()">🔍</button>
    </div>
  </div>

  <div id="resultList"></div>
  <div id="map"></div>

  <script>
    // 지도 초기화
    const map = new kakao.maps.Map(
      document.getElementById('map'),
      { center: new kakao.maps.LatLng(37.49334, 127.06672), level: 3 }
    );
    const ps = new kakao.maps.services.Places();
    let markers = [];

    // 드롭다운 토글
    function toggleDropdown() {
      const dd = document.getElementById('dropdown');
      dd.style.display = dd.style.display==='block'?'none':'block';
    }
    // 메뉴 선택
    function selectMenu(name) {
      document.getElementById('menuButton').textContent = name;
      document.getElementById('dropdown').style.display = 'none';
    }

    // 장소 검색
    function searchPlaces() {
      const kw = document.getElementById('keyword').value.trim();
      if (!kw) return alert('검색어를 입력하세요.');
      ps.keywordSearch(kw, placesSearchCB);
    }
    function placesSearchCB(data, status) {
      if (status === kakao.maps.services.Status.OK) {
        displayPlaces(data);
      } else {
        alert('검색 결과가 없습니다.');
      }
    }
    function displayPlaces(places) {
      const rl = document.getElementById('resultList');
      rl.innerHTML = '';
      clearMarkers();
      places.forEach(p => {
        // 리스트
        const div = document.createElement('div');
        div.className = 'item';
        const gu = p.address_name?.split(' ')[1]||'';
        div.innerHTML = `<div style="display:flex;justify-content:space-between;">
                           <span>${p.place_name}</span>
                           <span style="color:gray;font-size:14px;">${gu}</span>
                         </div>`;
        div.onclick = () => {
          map.setCenter(new kakao.maps.LatLng(p.y,p.x));
          rl.style.display = 'none';
        };
        rl.appendChild(div);
        // 마커
        const m = new kakao.maps.Marker({
          map, position: new kakao.maps.LatLng(p.y,p.x)
        });
        markers.push(m);
        const iw = new kakao.maps.InfoWindow({
          content: `<div style="padding:5px;font-size:14px;">${p.place_name}</div>`
        });
        kakao.maps.event.addListener(m,'click',()=>iw.open(map,m));
      });
      rl.style.display = 'block';
    }
    function clearMarkers() {
      markers.forEach(m=>m.setMap(null));
      markers = [];
    }

    // 내 위치
    function moveToCurrentLocation() {
      if (!navigator.geolocation) return alert('GPS를 지원하지 않습니다.');
      navigator.geolocation.getCurrentPosition(pos=>{
        const loc=new kakao.maps.LatLng(pos.coords.latitude,pos.coords.longitude);
        map.setCenter(loc);
        new kakao.maps.Marker({ map, position:loc });
      }, ()=>alert('위치 정보를 가져올 수 없습니다.'));
    }
  </script>
</body>
</html>
