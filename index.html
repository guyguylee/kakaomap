<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>부동산GPT 지도 검색</title>
  <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=bfd55780f8253cce45449ed9df7b7c7a&libraries=services"></script>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { width: 100%; height: 100%; }
    #topBar {
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      z-index: 10;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #controls {
      display: flex;
      gap: 8px;
    }
    button, select, input {
      padding: 5px 10px;
      font-size: 12px;
    }
    #resultList {
      position: absolute;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      overflow-y: auto;
      max-height: 200px;
      z-index: 5;
      display: none;
    }
    .item {
      padding: 8px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    .item:hover {
      background: #f0f0f0;
    }
  </style>
</head>
<body>

<div id="topBar">
  <div id="controls">
    <select id="category">
      <option>아파트</option>
      <option>분양권</option>
      <option>원룸</option>
      <option>투룸</option>
      <option>관심</option>
    </select>
    <button onclick="moveToCurrentLocation()">내 위치</button>
  </div>
  <div id="search">
    <input type="text" id="keyword" placeholder="검색어 입력" />
    <button onclick="searchPlaces()">검색</button>
  </div>
</div>

<div id="resultList"></div>
<div id="map"></div>

<script>
  var map = new kakao.maps.Map(document.getElementById('map'), {
    center: new kakao.maps.LatLng(37.5665, 126.9780), // 서울 중심
    level: 3
  });

  var ps = new kakao.maps.services.Places();
  var markers = [];

  function searchPlaces() {
    var keyword = document.getElementById('keyword').value;
    if (!keyword.trim()) {
      alert('검색어를 입력하세요.');
      return;
    }
    ps.keywordSearch(keyword, placesSearchCB);
  }

  function placesSearchCB(data, status) {
    if (status === kakao.maps.services.Status.OK) {
      displayPlaces(data);
    } else {
      alert('검색 결과가 없습니다.');
    }
  }

  function displayPlaces(places) {
    clearMarkers();
    var listEl = document.getElementById('resultList');
    listEl.innerHTML = '';
    listEl.style.display = 'block';

    places.forEach(function(place) {
      var marker = new kakao.maps.Marker({
        map: map,
        position: new kakao.maps.LatLng(place.y, place.x)
      });
      markers.push(marker);

      var el = document.createElement('div');
      el.className = 'item';
      el.textContent = place.place_name;
      el.onclick = function() {
        map.setCenter(new kakao.maps.LatLng(place.y, place.x));
        document.getElementById('keyword').value = '';
        listEl.style.display = 'none';
      };
      listEl.appendChild(el);
    });
  }

  function clearMarkers() {
    markers.forEach(function(marker) {
      marker.setMap(null);
    });
    markers = [];
  }

  function moveToCurrentLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var loc = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);
        map.setCenter(loc);

        var marker = new kakao.maps.Marker({
          map: map,
          position: loc
        });
      });
    } else {
      alert('이 브라우저는 GPS를 지원하지 않습니다.');
    }
  }
</script>

</body>
</html>
